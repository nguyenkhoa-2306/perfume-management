<%- include('../../layouts/main', { title: perfume.perfumeName, body: `
<div class="row">
  <!-- IMAGE -->
  <div class="col-md-4">
    <img
      src="<%= perfume.uri %>"
      class="img-fluid rounded"
      alt="<%= perfume.perfumeName %>"
    />
    <% if (perfume.concentration === 'Extrait') { %>
    <div class="text-center mt-2">
      <span class="badge extrait-badge fs-5">PREMIUM EXTRAT</span>
    </div>
    <% } %>
  </div>

  <!-- INFO -->
  <div class="col-md-8">
    <h1><%= perfume.perfumeName %></h1>
    <p class="text-muted"><%= perfume.brand.brandName %></p>

    <div class="row mb-3">
      <div class="col-6">
        <p><strong>Price:</strong> $<%= perfume.price %></p>
        <p><strong>Volume:</strong> <%= perfume.volume %>ml</p>
        <p><strong>Concentration:</strong> <%= perfume.concentration %></p>
      </div>
      <div class="col-6">
        <p>
          <strong>Audience:</strong>
          <i
            class="fas fa-<%= perfume.targetAudience === 'male' ? 'mars' : perfume.targetAudience === 'female' ? 'venus' : 'mercury' %>"
          ></i>
          <%= perfume.targetAudience %>
        </p>
      </div>
    </div>

    <p><strong>Description:</strong></p>
    <p><%= perfume.description %></p>
    <p><strong>Ingredients:</strong> <%= perfume.ingredients %></p>
  </div>
</div>

<!-- COMMENTS -->
<% if (user) { %>
<div class="mt-5">
  <h3>Add Your Comment</h3>
  <form id="commentForm">
    <div class="mb-3">
      <label>Rating</label>
      <select name="rating" class="form-select" required>
        <option value="">Select rating</option>
        <% for(let i=1; i<=5; i++) { %>
        <option value="<%= i %>"><%= i %> Star<%= i>1 ? 's' : '' %></option>
        <% } %>
      </select>
    </div>
    <div class="mb-3">
      <label>Comment</label>
      <textarea
        name="content"
        class="form-control"
        rows="3"
        required
      ></textarea>
    </div>
    <button type="submit" class="btn btn-warning">Submit Comment</button>
  </form>
</div>
<% } %>

<!-- COMMENTS LIST -->
<div class="mt-5">
  <h3>Comments (<%= perfume.comments.length %>)</h3>
  <% perfume.comments.forEach(comment => { %>
  <div class="card mb-3">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <h6>
          <%= comment.author.name %>
          <small class="text-muted"
            >â€¢ <%= new Date(comment.createdAt).toLocaleDateString() %></small
          >
        </h6>
        <div class="star-rating">
          <% for(let i=1; i<=5; i++) { %>
          <i
            class="fas fa-star <%= i <= comment.rating ? 'star' : 'far fa-star' %>"
          ></i>
          <% } %>
        </div>
      </div>
      <p class="mt-2"><%= comment.content %></p>
    </div>
  </div>
  <% }) %>
</div>

<script>
  $("#commentForm").submit(async function (e) {
    e.preventDefault();
    const formData = new FormData(this);
    formData.append("perfumeId", "<%= perfume._id %>");

    const res = await fetch(`/api/perfumes/<%= perfume._id %>/comment`, {
      method: "POST",
      headers: { Authorization: "Bearer <%= user.token %>" },
      body: formData,
    });

    if (res.ok) location.reload();
  });
</script>
` }) %>
